<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content has-shadow">

      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Edit Change {{updatePunchItemModel.punchNo}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="onCancel()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <form (ngSubmit)="onSubmit(f)" #f="ngForm" novalidate>

        <div class="modal-body">

          <div class="row">

            <div class="col-4 form-group">
              <label>Tag: <span class="required"></span></label>
              <ng-select name="tag" [items]="tagTempModels" bindValue="id" bindLabel="value" placeholder="Select tag"
                #tag="ngModel" [(ngModel)]="updatePunchItemModel.tagId" appendTo="body" [virtualScroll]="true"
                [loading]="loadingSelection.isLoadingTag" (scrollToEnd)="onScrollToEndSelect(selectionControlName.tag)"
                (search)="onSearchSelect($event, selectionControlName.tag)"
                (clear)="onClearSelect(selectionControlName.tag)" (change)="onChangeTag()" required>
              </ng-select>
              <div *ngIf="tag.invalid && (tag.dirty || tag.touched || f.submitted)" class="error">
                <div *ngIf="tag.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>Discipline:</label>
              <ng-select name="discipline" [items]="disciplineTempModels" bindValue="id" bindLabel="value"
                placeholder="Select discipline" #discipline="ngModel" [(ngModel)]="updatePunchItemModel.disciplineId"
                appendTo="body" [virtualScroll]="true" [loading]="loadingSelection.isLoadingDiscipline"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.discipline)"
                (search)="onSearchSelect($event, selectionControlName.discipline)"
                (clear)="onClearSelect(selectionControlName.discipline)" (change)="onChangeDiscipline()">
              </ng-select>
            </div>

            <div class="col-4 form-group">
              <label>Type: <span class="required"></span></label>
              <ng-select name="type" [items]="typeTempModels" bindValue="id" bindLabel="value" placeholder="Select type"
                #type="ngModel" [(ngModel)]="updatePunchItemModel.punchTypeId" appendTo="body" [virtualScroll]="true"
                [loading]="loadingSelection.isLoadingType"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.type)"
                (search)="onSearchSelect($event, selectionControlName.type)"
                (clear)="onClearSelect(selectionControlName.type)" required>
              </ng-select>
              <div *ngIf="type.invalid && (type.dirty || type.touched || f.submitted)" class="error">
                <div *ngIf="type.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>System:</label>
              <ng-select name="system" [items]="systemTempModels" bindValue="id" bindLabel="value"
                placeholder="Select system" #system="ngModel" [(ngModel)]="systemId" appendTo="body"
                [virtualScroll]="true" [loading]="loadingSelection.isLoadingSystem"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.system)"
                (search)="onSearchSelect($event, selectionControlName.system)"
                (clear)="onClearSelect(selectionControlName.system)" (change)="onChangeSystem()">
              </ng-select>
            </div>

            <div class="col-4 form-group">
              <label>Description: <span class="required"></span></label>
              <input type="text" name="description" placeholder="Enter description" class="form-control"
                [matAutocomplete]="autoDescription" #description="ngModel"
                [(ngModel)]="updatePunchItemModel.description" (change)="onChangeDescription()">
              <mat-autocomplete #autoDescription="matAutocomplete" (optionSelected)='onChangeDescription()'>
                <mat-option *ngFor="let option of descriptionModels" [value]="option.description">
                  {{option.description}}
                </mat-option>
              </mat-autocomplete>
            </div>

            <div class="col-4 form-group">
              <label>Location: <span class="required"></span></label>
              <ng-select name="location" [items]="locationTempModels" bindValue="id" bindLabel="value"
                placeholder="Select location" #location="ngModel" [(ngModel)]="updatePunchItemModel.locationId"
                appendTo="body" [virtualScroll]="true" [loading]="loadingSelection.isLoadingLocation"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.location)"
                (search)="onSearchSelect($event, selectionControlName.location)"
                (clear)="onClearSelect(selectionControlName.location)" required>
              </ng-select>
              <div *ngIf="location.invalid && (location.dirty || location.touched || f.submitted)" class="error">
                <div *ngIf="location.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>Sub-system:</label>
              <ng-select name="subSystem" [items]="subSystemTempModels" bindValue="id" bindLabel="value"
                placeholder="Select sub-system" #subSystem="ngModel" [(ngModel)]="subSystemId" appendTo="body"
                [virtualScroll]="true" [loading]="loadingSelection.isLoadingSubSystem"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.subSystem)"
                (search)="onSearchSelect($event, selectionControlName.subSystem)"
                (clear)="onClearSelect(selectionControlName.subSystem)" (change)="onChangeSubSystem()" [disabled]="lookSubSystem">
              </ng-select>
            </div>

            <div class="col-4 form-group">
              <label>Corrective Action: <span class="required"></span></label>
              <input type="text" name="correctiveAction" placeholder="Enter corrective action" class="form-control"
                [matAutocomplete]="autoCorrectiveAction" #correctiveAction="ngModel"
                [(ngModel)]="updatePunchItemModel.correctiveAction" required>
              <mat-autocomplete #autoCorrectiveAction="matAutocomplete">
                <mat-option *ngFor="let option of correctiveActionModels" [value]="option.correctiveAction">
                  {{option.correctiveAction}}
                </mat-option>
              </mat-autocomplete>
              <div
                *ngIf="correctiveAction.invalid && (correctiveAction.dirty || correctiveAction.touched || f.submitted)"
                class="error">
                <div *ngIf="correctiveAction.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>Materials Required: <span class="required"></span></label>
              <ng-select name="materialsRequired" [items]="materialsRequiredModels" bindValue="value" bindLabel="label"
                placeholder="Select materials required" #materialsRequired="ngModel"
                [(ngModel)]="updatePunchItemModel.materialsRequired" appendTo="body" required>
              </ng-select>
              <div
                *ngIf="materialsRequired.invalid && (materialsRequired.dirty || materialsRequired.touched || f.submitted)"
                class="error">
                <div *ngIf="materialsRequired.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>Drawing: <span class="required"></span></label>
              <ng-select name="drawing" [items]="drawingTempModels" [multiple]="true" bindValue="drawingId"
                bindLabel="drawingNo" placeholder="Select drawing" #drawing="ngModel"
                [(ngModel)]="updatePunchItemModel.drawingIds" appendTo="body" [virtualScroll]="true"
                [loading]="loadingSelection.isLoadingDrawing"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.drawing)"
                (search)="onSearchSelect($event, selectionControlName.drawing)"
                (clear)="onClearSelect(selectionControlName.drawing)" (change)="onCheckDrawingLocation()" required>
                <ng-template ng-label-tmp let-item="item" let-clear="clear">
                  <span class="ng-value-label">{{item.drawingNo}} <span *ngIf="item.isLocationDrawing"
                      class="ml-1 badge-success badge font-weight-normal">
                      Location
                    </span></span>
                  <span class="ng-value-icon right" (click)="onClearDrawingSelect(item)">Ã—</span>
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-index="index">
                  <div class="float-left text-left">
                    <span>{{item.drawingNo}}</span>
                  </div>
                  <div class="float-right text-right">
                    <span *ngIf="item.isLocationDrawing" class="badge-success badge font-weight-normal p-2">
                      Location
                    </span>
                  </div>
                </ng-template>
              </ng-select>

              <div *ngIf="drawing.invalid && (drawing.dirty || drawing.touched || f.submitted)" class="error">
                <div *ngIf="drawing.errors?.required">This field is required</div>
              </div>
              <div *ngIf="isDrawingError" class="error">
                <div *ngIf="isDrawingError">There must be at least one drawing location</div>
              </div>
            </div>

            <div class="col-4 form-group">
              <label>Category: <span class="required"></span></label>
              <ng-select name="category" [items]="categoryModels" bindValue="category" bindLabel="category"
                placeholder="Select category" #category="ngModel" [(ngModel)]="updatePunchItemModel.category"
                appendTo="body" required>
              </ng-select>
              <div *ngIf="category.invalid && (category.dirty || category.touched || f.submitted)" class="error">
                <div *ngIf="category.errors?.required">This field is required</div>
              </div>
            </div>

            <div class="col-4 form-group" *ngIf="updatePunchItemModel.materialsRequired">
              <label>Order No: <span class="required"></span></label>
              <ng-select name="orderNo" [items]="orderNoTempModels" bindValue="id" bindLabel="value"
                placeholder="Select order no" #orderNo="ngModel" [(ngModel)]="updatePunchItemModel.orderId"
                appendTo="body" [virtualScroll]="true" [loading]="loadingSelection.isLoadingOrderNo"
                (scrollToEnd)="onScrollToEndSelect(selectionControlName.orderNo)"
                (search)="onSearchSelect($event, selectionControlName.orderNo)"
                (clear)="onClearSelect(selectionControlName.orderNo)" required>
              </ng-select>
              <div *ngIf="orderNo.invalid && (orderNo.dirty || orderNo.touched || f.submitted)" class="error">
                <div *ngIf="orderNo.errors?.required">This field is required</div>
              </div>
            </div>

          </div>

        </div>

        <div class="modal-footer">
          <button mat-raised-button type="button" color="info" class="mr-2" (click)="onSaveAsDraft()">Save</button>
          <button mat-raised-button type="submit" color="primary" class="mr-2">Submit</button>
          <a mat-raised-button data-dismiss="modal" (click)="onCancel()">Cancel</a>
        </div>

      </form>
    </div>
  </div>
</div>
